suite: Test deployment rendering
templates:
  - deployment.yaml
tests:
  - it: should set image tag
    set:
      image.tag: "mytag"
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: "ghcr.io/cyberhippo/github-dependabot-exporter:mytag"
  - it: should set environment variable
    set:
      env.GITHUB_ORG: "acme"
    asserts:
      - equal:
          path: spec.template.spec.containers[0].env[?(@.name=="GITHUB_ORG")].value
          value: "acme"
  - it: should set pod annotations
    set:
      podAnnotations:
          annotation/foo-bar: "foo-bar"
    asserts:
      - equal:
          path: spec.template.metadata.annotations.annotation/foo-bar
          value: foo-bar
  - it: should set deployment annotation
    set:
      annotations:
        annotation/foo-bar: "foo-bar"
    asserts:
      - equal:
          path: metadata.annotations.annotation/foo-bar
          value: foo-bar